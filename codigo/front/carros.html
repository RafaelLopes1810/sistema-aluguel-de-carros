<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Carros DisponÃ­veis</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="navbar">
    <div class="logo">ðŸš— AlugaCar</div>
    <nav>
      <a href="index.html">InÃ­cio</a>
      <a href="login.html">Login</a>
      <a href="carros.html" class="ativo">Carros</a>
      <a href="pedidos.html">Meus Pedidos</a>
      <a href="perfil.html">Perfil</a>
    </nav>
  </header>

  <main>
    <!-- BotÃ£o sÃ³ visÃ­vel para admin -->
    <button id="admin-btn" style="display:none;" onclick="window.location.href='cadastroCarro.html'">
      âž• Cadastrar Novo Carro
    </button>

    <section class="destaques">
      <h2>Carros DisponÃ­veis</h2>
      <div class="card-container">
        
      </div>
    </section>
  </main>

  <footer>
    <p>Â© 2025 AlugaCar - Todos os direitos reservados.</p>
  </footer>

<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Carros DisponÃ­veis</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="navbar">
    <div class="logo">ðŸš— AlugaCar</div>
    <nav>
      <a href="index.html">InÃ­cio</a>
      <a href="login.html">Login</a>
      <a href="carros.html" class="ativo">Carros</a>
      <a href="pedidos.html">Meus Pedidos</a>
      <a href="perfil.html">Perfil</a>
    </nav>
  </header>

  <main>
    <!-- BotÃ£o sÃ³ visÃ­vel para admin -->
    <button id="admin-btn" style="display:none;" onclick="window.location.href='cadastroCarro.html'">
      âž• Cadastrar Novo Carro
    </button>

    <section class="destaques">
      <h2>Carros DisponÃ­veis</h2>
      <div class="card-container"></div>
    </section>
  </main>

  <footer>
    <p>Â© 2025 AlugaCar - Todos os direitos reservados.</p>
  </footer>

  <script>
    const apiUrl = "http://localhost:8080/api/carros";
    const pedidosApiUrl = "http://localhost:8080/api/pedidos";
    const cardContainer = document.querySelector(".card-container");

    // Pega informaÃ§Ãµes do usuÃ¡rio logado
    const clienteId = localStorage.getItem("clienteId");
    const clienteEmail = localStorage.getItem("clienteEmail");
    const isAdmin = (clienteEmail === "admin");

    // FunÃ§Ã£o para carregar carros
    async function carregarCarros() {
      try {
        const response = await fetch(apiUrl);
        const carros = await response.json();

        cardContainer.innerHTML = "";

        if (carros.length === 0) {
          cardContainer.innerHTML = "<p>Nenhum carro disponÃ­vel no momento.</p>";
          return;
        }

        carros.forEach(carro => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img class="car-img" src="${carro.foto}" alt="${carro.nome}">
            <h3>${carro.nome}</h3>
            <p>Ano: ${carro.ano} | Placa: ${carro.placa}</p>
            ${!isAdmin ? `<button onclick="alugarCarro(${carro.id})">Alugar</button>` : ""}
            ${isAdmin ? `<button onclick="deletarCarro(${carro.id})">Excluir</button>` : ""}
          `;
          cardContainer.appendChild(card);
        });

        if (isAdmin) {
          document.getElementById("admin-btn").style.display = "block";
        }
      } catch (error) {
        console.error("Erro ao carregar carros:", error);
        cardContainer.innerHTML = "<p>Erro ao carregar carros do servidor.</p>";
      }
    }

    // FunÃ§Ã£o para excluir carro (apenas admin)
    async function deletarCarro(id) {
      if (confirm("Tem certeza que deseja excluir este carro?")) {
        await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
        carregarCarros();
      }
    }

    // FunÃ§Ã£o para alugar carro (criar pedido)
    async function alugarCarro(carroId) {
      if (!clienteId) {
        alert("VocÃª precisa estar logado para alugar um carro!");
        window.location.href = "login.html";
        return;
      }

      try {
        const response = await fetch(`${pedidosApiUrl}?clienteId=${clienteId}&carroId=${carroId}`, {
          method: "POST"
        });

        if (response.ok) {
          alert("Pedido de aluguel criado com sucesso! VocÃª pode acompanhar em 'Meus Pedidos'.");
          window.location.href = "pedidos.html";
        } else {
          alert("Erro ao criar pedido de aluguel.");
        }
      } catch (error) {
        console.error("Erro ao criar pedido:", error);
        alert("Erro de conexÃ£o com servidor.");
      }
    }

    carregarCarros();
  </script>

  <script src="script.js"></script>
</body>

</html>
