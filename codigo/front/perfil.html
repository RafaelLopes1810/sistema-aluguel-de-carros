<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Perfil - Sistema de Aluguel de Carros</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="page-container">
        <div class="content-wrap">
            <header class="navbar">
                <div class="logo">ðŸš— AlugaCar</div>
                <nav>
                    <a href="index.html">InÃ­cio</a>
                    <a href="login.html">Login</a>
                    <a href="carros.html">Carros</a>
                    <a href="pedidos.html">Meus Pedidos</a>
                    <a href="perfil.html">Perfil</a>
                </nav>
            </header>
            <main>
                <section class="cadastro-section">
                    <div class="cadastro-card">
                        <h2>Meu Perfil</h2>
                        <form id="perfilForm">
                            <label for="nome">Nome:</label>
                            <input type="text" id="nome" name="nome" required>

                            <label for="cpf">CPF:</label>
                            <input type="text" id="cpf" name="cpf" required>

                            <label for="endereco">EndereÃ§o:</label>
                            <input type="text" id="endereco" name="endereco" required>

                            <label for="telefone">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone" required>

                            <label for="profissao">ProfissÃ£o:</label>
                            <input type="text" id="profissao" name="profissao" required>

                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email" required>

                            <label for="senha">Senha:</label>
                            <input type="password" id="senha" name="senha" required>

                            <button type="submit">Salvar AlteraÃ§Ãµes</button>
                            <button type="button" id="deletarBtn" class="danger">Deletar Conta</button>
                        </form>
                    </div>
                </section>
            </main>
        </div>

        <footer>
            <p>Â© 2025 AlugaCar - Todos os direitos reservados.</p>
        </footer>
    </div>

    <script>
        const clienteId = localStorage.getItem("clienteId");

        if (!clienteId) {
            alert("VocÃª precisa estar logado para acessar o perfil.");
            window.location.href = "login.html";
        }

        // carregar dados do cliente
        async function carregarPerfil() {
            try {
                const response = await fetch(`http://localhost:8080/clientes/${clienteId}`);
                if (response.ok) {
                    const cliente = await response.json();
                    document.getElementById("nome").value = cliente.nome;
                    document.getElementById("cpf").value = cliente.cpf;
                    document.getElementById("endereco").value = cliente.endereco;
                    document.getElementById("telefone").value = cliente.telefone;
                    document.getElementById("profissao").value = cliente.profissao;
                    document.getElementById("email").value = cliente.email;
                    document.getElementById("senha").value = cliente.senha;
                } else {
                    alert("Erro ao carregar perfil.");
                }
            } catch (error) {
                console.error("Erro:", error);
            }
        }

        // atualizar cliente
        document.getElementById("perfilForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const cliente = {
                nome: document.getElementById("nome").value,
                cpf: document.getElementById("cpf").value,
                endereco: document.getElementById("endereco").value,
                telefone: document.getElementById("telefone").value,
                profissao: document.getElementById("profissao").value,
                email: document.getElementById("email").value,
                senha: document.getElementById("senha").value
            };

            try {
                const response = await fetch(`http://localhost:8080/clientes/${clienteId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(cliente)
                });

                if (response.ok) {
                    alert("Perfil atualizado com sucesso!");
                } else {
                    alert("Erro ao atualizar perfil.");
                }
            } catch (error) {
                console.error("Erro:", error);
            }
        });

        // deletar cliente
        document.getElementById("deletarBtn").addEventListener("click", async () => {
            if (!confirm("Tem certeza que deseja deletar sua conta?")) return;

            try {
                const response = await fetch(`http://localhost:8080/clientes/${clienteId}`, {
                    method: "DELETE"
                });

                if (response.ok) {
                    alert("Conta deletada com sucesso!");
                    window.location.href = "index.html";
                } else {
                    alert("Erro ao deletar conta.");
                }
            } catch (error) {
                console.error("Erro:", error);
            }
        });

        carregarPerfil();
    </script>
</body>

</html>